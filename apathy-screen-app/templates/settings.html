{% extends "base.html" %}

{% block title %}管理者ダッシュボード{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">

    <div class="d-flex align-items-center mb-4">
      <div class="bg-dark text-white p-3 rounded-circle me-3 shadow-sm">
        <i class="bi bi-sliders fs-3"></i>
      </div>
      <div>
        <h2 class="fw-bold mb-0">管理者ダッシュボード</h2>
        <p class="text-muted mb-0">システム設定およびプロジェクト進行管理</p>
      </div>
    </div>

    {% if is_admin %}
      
      <!-- プロジェクト進行状況 -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white py-3 border-bottom-0">
          <h5 class="card-title fw-bold mb-0"><i class="bi bi-kanban me-2 text-primary"></i>プロジェクト進行状況</h5>
        </div>
        <div class="card-body p-4 pt-0">
          <div class="position-relative m-4">
            <!-- 進捗バー: Step 1=0%, Step 2=100% -->
            <div class="progress" style="height: 4px;">
              <div class="progress-bar bg-{{ 'success' if current_step > 1 else 'primary' }}" 
                   role="progressbar" 
                   style="width: {{ (current_step - 1) * 100 }}%;" 
                   aria-valuenow="{{ (current_step - 1) * 100 }}" 
                   aria-valuemin="0" 
                   aria-valuemax="100"></div>
            </div>
            
            <!-- Step 1 Button -->
            <button type="button" 
                    class="position-absolute top-0 start-0 translate-middle btn btn-sm btn-{{ 'success' if current_step > 1 else 'primary' }} rounded-pill" 
                    style="width: 3rem; height:3rem;">1</button>
            
            <!-- Step 2 Button -->
            <button type="button" 
                    class="position-absolute top-0 start-100 translate-middle btn btn-sm btn-{{ 'primary' if current_step == 2 else 'secondary' }} rounded-pill" 
                    style="width: 3rem; height:3rem;">2</button>
            
            <div class="d-flex justify-content-between mt-2">
              <div class="text-center small fw-bold">
                一次スクリーニング<br>
                <span class="text-{{ 'success' if current_step > 1 else 'primary' }}">
                  {{ '完了' if current_step > 1 else '進行中' }}
                </span>
              </div>
              <div class="text-center small fw-bold {{ 'text-primary' if current_step == 2 else 'text-muted' }}">
                合議・データ出力<br>
                <span class="fw-normal">{{ '進行中' if current_step == 2 else '未着手' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4">
        <!-- システム設定 -->
        <div class="col-md-6">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-header bg-white py-3 border-bottom-0">
              <h5 class="card-title fw-bold mb-0">システム基本設定</h5>
            </div>
            <div class="card-body p-4">
              <form method="post" action="/settings">
                <div class="mb-4">
                  <label for="year_min" class="form-label fw-bold">対象とする出版年（Min）</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light"><i class="bi bi-calendar-event"></i></span>
                    <input type="number" class="form-control" id="year_min" name="year_min" value="{{ year_min if year_min is not none }}" placeholder="例：2015（空欄で制限なし）">
                    <span class="input-group-text bg-white">年 以降</span>
                  </div>
                  <div class="form-text mt-2 text-danger">
                    <i class="bi bi-exclamation-triangle-fill me-1"></i>変更すると全ユーザーの表示範囲が変わります。慎重に操作してください。
                  </div>
                </div>
                <div class="d-flex justify-content-end">
                  <button type="submit" class="btn btn-secondary fw-bold px-4">
                    <i class="bi bi-save me-1"></i>設定を保存
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- ユーザー管理 -->
        <div class="col-md-6">
          <div class="card h-100 border-0 shadow-sm">
            <div class="card-header bg-white py-3 border-bottom-0">
              <h5 class="card-title fw-bold mb-0">ユーザー管理</h5>
            </div>
            <div class="card-body p-4 d-flex flex-column justify-content-center align-items-center text-center">
              <div class="mb-3 text-secondary">
                <i class="bi bi-people-fill display-4"></i>
              </div>
              <p class="text-muted mb-4">
                ユーザー名、担当グループ、管理者権限の編集が行えます。<br>
                メンバー変更や権限移譲の際にご利用ください。
              </p>
              <a href="/admin/users" class="btn btn-outline-primary fw-bold w-100">
                <i class="bi bi-gear-fill me-2"></i>ユーザー管理画面へ
              </a>
            </div>
          </div>
        </div>
      </div>

    {% else %}
      <div class="card border-0 shadow-sm text-center py-5">
        <div class="card-body">
          <div class="mb-3 text-muted">
            <i class="bi bi-shield-lock-fill display-1 opacity-25"></i>
          </div>
          <h4 class="fw-bold">管理者権限が必要です</h4>
          <p class="text-muted">このページはプロジェクト管理者のみがアクセスできます。</p>
          <a href="/" class="btn btn-outline-primary mt-3">トップページへ戻る</a>
        </div>
      </div>
    {% endif %}

  </div>
</div>
{% endblock %}