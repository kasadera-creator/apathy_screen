{% extends "base.html" %}

{% block title %}äºŒæ¬¡ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚° - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<style>
  .badge-pending { background-color: #ffc107; color: black; }
  .badge-include { background-color: #28a745; color: white; }
  .badge-exclude { background-color: #dc3545; color: white; }
  .badge-completed { background-color: #17a2b8; color: white; }
  .candidate-item { 
    padding: 10px;
    border: 1px solid #ddd;
    margin-bottom: 5px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .candidate-item:hover {
    background-color: #f5f5f5;
  }
  .candidate-item a {
    text-decoration: none;
    color: inherit;
    flex-grow: 1;
  }
  .candidate-item a:hover {
    text-decoration: underline;
  }
  .candidates-list {
    max-height: 400px;
    overflow-y: auto;
  }
</style>

<h3>äºŒæ¬¡ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°</h3>
<div class="row">
  {% for g, s in stats.items() %}
    <div class="col-md-3 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">{{ SECONDARY_GROUP_LABELS[g] if g in SECONDARY_GROUP_LABELS else g|capitalize }}</h5>
          <p class="card-text">
            åˆè¨ˆ: {{ s.total }}<br>
            <small>æœªå‡¦ç†: {{ s.pending }}</small><br>
            <small>æ¡ç”¨: {{ s.included }}</small><br>
            <small>é™¤å¤–: {{ s.excluded }}</small><br>
            {% if s.completed > 0 %}<small>å®Œäº†æ¸ˆã¿: <span class="badge badge-completed">{{ s.completed }}</span></small>{% endif %}
          </p>
          <a href="/secondary/{{ g }}/next" class="btn btn-primary btn-sm">æ¬¡ã®æœªç€æ‰‹ã¸</a>
          
          <!-- Expandable candidates list -->
          {% if g in candidates_by_group and candidates_by_group[g]|length > 0 %}
          <div class="mt-2">
            <button class="btn btn-outline-secondary btn-sm" type="button" data-toggle="collapse" data-target="#candidates-{{ g }}">
              å€™è£œä¸€è¦§ã‚’è¡¨ç¤º
            </button>
            <div class="collapse mt-2" id="candidates-{{ g }}">
              <div class="candidates-list">
                {% for cand in candidates_by_group[g] %}
                  <div class="candidate-item">
                    <a href="/secondary/{{ g }}/{{ cand.pmid }}">
                      PMID: {{ cand.pmid }}
                    </a>
                    <span class="badge" style="margin-left: 10px;"
                      {% if cand.is_completed %}
                        style="background-color: #17a2b8; color: white;"
                      {% elif cand.status == 'pending' %}
                        style="background-color: #ffc107; color: black;"
                      {% elif cand.status == 'include' %}
                        style="background-color: #28a745; color: white;"
                      {% elif cand.status == 'exclude' %}
                        style="background-color: #dc3545; color: white;"
                      {% endif %}
                    >
                      {% if cand.is_completed %}
                        âœ“ å®Œäº†æ¸ˆã¿
                      {% elif cand.status == 'pending' %}
                        ğŸŸ¡ æœªå‡¦ç†
                      {% elif cand.status == 'include' %}
                        âœ“ æ¡ç”¨
                      {% elif cand.status == 'exclude' %}
                        âœ— é™¤å¤–
                      {% endif %}
                    </span>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}

